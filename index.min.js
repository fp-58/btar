(()=>{const t=512;class e{#t=new Map;#e=[];t(t,e,r){t.endsWith("/")&&(t=t.substring(0,t.length-1));const i=t.lastIndexOf("/"),o=n(t.substring(i+1),r?.mode??420,r?.i??0,r?.o??0,e.size,e.lastModified,-1,0,"",0,r?.l??"",r?.u??"",0,0,t.substring(0,i+1));this.#t.set(t,this.#e.length),this.#e.push({h:o,content:e})}p(t,e){let r=t.lastIndexOf("/");r===t.length-1?r=t.substring(0,r).lastIndexOf("/"):t+="/";const i=n(t.substring(r+1),e?.mode??509,e?.i??0,e?.o??0,0,e?.lastModified??Date.now(),-1,5,"",0,e?.l??"",e?.u??"",0,0,t.substring(0,r+1));this.#t.set(t,this.#e.length),this.#e.push({h:i})}static async m(r){let i=0;const o=new e;for(let e=await l();e;e=await l()){let n=i*t,s=n+e.size;if(r.size<s)throw Error(`Malformed archive: Expected size ${s}, got size ${r.size}`);let c,f=e.prefix+e.name;if(f.endsWith("/")){let t=f.substring(0,f.length-1),e=t.lastIndexOf("/");c=t.substring(e)}else{let t=f.lastIndexOf("/");c=f.substring(t)}const l=new a([r.slice(n,s)],c,f,{lastModified:e.lastModified,A:"transparent"});o.#t.set(f,o.#e.length),o.#e.push({h:e,content:l}),i+=Math.ceil(e.size/t)}async function l(){const e=await async function(){const e=await u();r.size-i*t>-512&&i++;return e}();if(f(e)){if(f(await u()))return null}return n(s(e,0,100),c(e,100,8),c(e,108,8),c(e,116,8),c(e,124,12),c(e,136,12),c(e,148,8),c(e,156,1),s(e,157,100),c(e,263,3),s(e,265,32),s(e,297,32),c(e,329,8),c(e,337,8),s(e,345,155))}async function u(){let e=i*i,n=e+t;if(r.size<e)return new Uint8Array(t);if(r.size<n){const n=new Uint8Array(t),i=r.slice(e),o=new Uint8Array(await i.arrayBuffer());return n.set(o),n}{const t=r.slice(e,n);return new Uint8Array(await t.arrayBuffer())}}}trim(){let t=new Set;for(let e=this.#e.length-1;e>=0;e--){const n=this.#e[e],r=n.h.prefix+n.h.name;t.has(r)?(this.#e.splice(e,1),e++):t.add(r)}const e=this.#e.map(((t,e)=>[t.h.prefix+t.h.name,e]));this.#t=new Map(e)}toBlob(){const e=[];for(const n of this.#e){const i=new Uint8Array(t);if(r(n.h,i),e.push(i),n.content){e.push(n.content);let r=n.content.size%t;if(r>0){const n=new ArrayBuffer(t-r);e.push(n)}}}const n=new ArrayBuffer(1024);return e.push(n),new Blob(e,{A:"transparent",type:"application/x-tar"})}}function n(t,e,n,i,o,a,s,c,f,l,u,d,w,h,y){const p={name:t,mode:e,i:n,o:i,size:o,lastModified:a,M:s,U:c,v:f,version:l,l:u,u:d,k:w,j:h,prefix:y};if(-1===s){const t=new Uint8Array(500);r(p,t);const e=21;p.M=function(t,e){const n=(2<<e)-1,r=148,i=156;let o=0;for(let e=0;e<t.length;e++){let a=t[e];r<=e&&e<=i&&(a=32),o=o+a&n}return o}(t,e)}return p}function r(t,e,n=0){e=e.subarray(n,n+500),i(t.name,e,0,100),o(t.mode,e,100,8),o(t.i,e,108,8),o(t.o,e,116,8),o(t.size,e,124,12),o(t.lastModified,e,136,12),o(t.M,e,148,8),o(t.U,e,156,1),i(t.v,e,157,100),o(t.version,e,263,3),i(t.l,e,265,32),i(t.u,e,297,32),-1===t.k?e.fill(0,329,337):o(t.k,e,329,8),-1===t.j?e.fill(0,337,345):o(t.j,e,337,8),i(t.prefix,e,345,155)}function i(t,e,n=0,r=e.length-n){e=e.subarray(n,n+r);const i=(new TextEncoder).encodeInto(t,e).written;i<r&&(e[i]=0)}function o(t,e,n=0,r=e.length-n){Math.ceil(Math.log2(t)/3)<r&&(e[n+--r]=0);for(let i=r-1;i>=n;i--){const n=48+(7&t);t>>=3,e[i]=n}}class a extends File{#n;constructor(t,e,n,r){super(t,e,r),this.#n=n}get webkitRelativePath(){return this.#n}}function s(t,e=0,n=t.length-e){t=new Uint8Array(t,e,n);const r=new TextDecoder;for(let e=0;e<n;e++)if(0===t[e]){t=t.subarray(0,e);break}return r.decode(t)}function c(t,e,n){t=new Uint8Array(t,e,n);let r=0;for(const e of t){if(0===e)break;r<<=3,e<49||55<e||(r|=e-48)}return r}function f(t){return t.every((t=>0===t))}"function"==typeof define&&define.amd?define((function(){return{TarArchive:e}})):"object"==typeof module&&module?module.exports.TarArchive=e:"object"==typeof exports&&exports?exports.TarArchive=e:"object"==typeof window&&window?window.TarArchive=e:globalThis.TarArchive=e})();