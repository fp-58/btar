(()=>{class t{#t=new Map;#e=[];t(t,n,r){t.endsWith("/")&&(t=t.substring(0,t.length-1));const i=t.lastIndexOf("/"),o=e(t.substring(i+1),r?.mode??420,r?.i??0,r?.o??0,n.size,n.lastModified,-1,0,"",0,r?.u??"",r?.l??"",0,0,t.substring(0,i+1));this.#t.set(t,this.#e.length),this.#e.push({h:o,content:n})}static async p(n){const r=512;let s=0;const f=new t;for(let t=await u();t;t=await u()){let e=s*r,o=e+t.size;if(n.size<o)throw Error(`Malformed archive: Expected size ${o}, got size ${n.size}`);let a,c=t.prefix+t.name;if(c.endsWith("/")){let t=c.substring(0,c.length-1),e=t.lastIndexOf("/");a=t.substring(e)}else{let t=c.lastIndexOf("/");a=c.substring(t)}const u=new i([n.slice(e,o)],a,c,{lastModified:t.lastModified,m:"transparent"});f.#t.set(c,f.#e.length),f.#e.push({h:t,content:u}),s+=Math.ceil(t.size/r)}async function u(){const t=await async function(){const t=await l();n.size-s*r>-512&&s++;return t}();if(c(t)){if(c(await l()))return null}return e(o(t,0,100),a(t,100,8),a(t,108,8),a(t,116,8),a(t,124,12),a(t,136,12),a(t,148,8),a(t,156,1),o(t,157,100),a(t,263,3),o(t,265,32),o(t,297,32),a(t,329,8),a(t,337,8),o(t,345,155))}async function l(){let t=s*s,e=t+r;if(n.size<t)return new Uint8Array(512);if(n.size<e){const e=new Uint8Array(512),r=n.slice(t),i=new Uint8Array(await r.arrayBuffer());return e.set(i),e}{const r=n.slice(t,e);return new Uint8Array(await r.arrayBuffer())}}}}function e(t,e,i,o,a,c,s,f,u,l,d,w,h,y,p){const m={name:t,mode:e,i,o,size:a,lastModified:c,A:s,M:f,v:u,version:l,u:d,l:w,U:h,k:y,prefix:p};if(-1===s){const t=new Uint8Array(500);m.A=0,function(t,e,i=0){e=e.subarray(i,i+500),n(t.name,e,0,100),r(t.mode,e,100,8),r(t.i,e,108,8),r(t.o,e,116,8),r(t.size,e,124,12),r(t.lastModified,e,136,12),r(t.A,e,148,8),r(t.M,e,156,1),n(t.v,e,157,100),r(t.version,e,263,3),n(t.u,e,265,32),n(t.l,e,297,32),-1===t.U?e.fill(0,329,337):r(t.U,e,329,8);-1===t.k?e.fill(0,337,345):r(t.k,e,337,8);n(t.prefix,e,345,155)}(m,t);const e=21;m.A=function(t,e){const n=(2<<e)-1;let r=0;for(const e of t)r=r+e&n;return r}(t,e)}return m}function n(t,e,n=0,r=e.length-n){e=e.subarray(n,n+r);const i=(new TextEncoder).encodeInto(t,e).written;i<r&&(e[i]=0)}function r(t,e,n=0,r=e.length-n){Math.ceil(Math.log2(t)/3)<r&&(e[n+--r]=0);for(let i=r-1;i>=n;i--){const n=48+(7&t);t>>=3,e[i]=n}}class i extends File{#n;constructor(t,e,n,r){super(t,e,r),this.#n=n}get webkitRelativePath(){return this.#n}}function o(t,e=0,n=t.length-e){t=new Uint8Array(t,e,n);const r=new TextDecoder;for(let e=0;e<n;e++)if(0===t[e]){t=t.subarray(0,e);break}return r.decode(t)}function a(t,e,n){t=new Uint8Array(t,e,n);let r=0;for(const e of t){if(0===e)break;r<<=3,e<49||55<e||(r|=e-48)}return r}function c(t){return t.every((t=>0===t))}"function"==typeof define&&define.amd?define((function(){return{TarArchive:t}})):"object"==typeof module&&module?module.exports.TarArchive=t:"object"==typeof exports&&exports?exports.TarArchive=t:"object"==typeof window&&window?window.TarArchive=t:globalThis.TarArchive=t})();