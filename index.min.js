(()=>{class t{#t=new Map;#n=[];t(t,e,r){t.endsWith("/")&&(t=t.substring(0,t.length-1));const o=t.lastIndexOf("/"),i=n(t.substring(o+1),r?.mode??420,r?.o??0,r?.i??0,e.size,e.lastModified,-1,0,"",0,r?.u??"",r?.l??"",0,0,t.substring(0,o+1));this.#t.set(t,this.#n.length),this.#n.push({h:i,content:e})}static async p(e){const r=512;let o=0;const f=new t;for(let t=await u();t;t=await u()){let n=o*r,a=n+t.size;if(e.size<a)throw Error(`Malformed archive: Expected size ${a}, got size ${e.size}`);let c,s=t.prefix+t.name;if(s.endsWith("/")){let t=s.substring(0,s.length-1),n=t.lastIndexOf("/");c=t.substring(n)}else{let t=s.lastIndexOf("/");c=s.substring(t)}const u=new i([e.slice(n,a)],c,s,{lastModified:t.lastModified,m:"transparent"});f.#t.set(s,f.#n.length),f.#n.push({h:t,content:u}),o+=Math.ceil(t.size/r)}async function u(){const t=await async function(){const t=await l();e.size-o*r>-512&&o++;return t}();if(s(t)){if(s(await l()))return null}return n(a(t,0,100),c(t,100,8),c(t,108,8),c(t,116,8),c(t,124,12),c(t,136,12),c(t,148,8),c(t,156,1),a(t,157,100),c(t,263,3),a(t,265,32),a(t,297,32),c(t,329,8),c(t,337,8),a(t,345,155))}async function l(){let t=o*o,n=t+r;if(e.size<t)return new Uint8Array(512);if(e.size<n){const n=new Uint8Array(512),r=e.slice(t),o=new Uint8Array(await r.arrayBuffer());return n.set(o),n}{const r=e.slice(t,n);return new Uint8Array(await r.arrayBuffer())}}}toBlob(){const t=[];for(const n of this.#n){const r=new Uint8Array(512);if(e(n.h,r),t.push(r),n.content){t.push(n.content);let e=n.content.size%512;if(e>0){const n=new ArrayBuffer(512-e);t.push(n)}}}const n=new ArrayBuffer(1024);return t.push(n),new Blob(t,{m:"transparent",type:"application/x-tar"})}}function n(t,n,r,o,i,a,c,s,f,u,l,w,d,y,h){const p={name:t,mode:n,o:r,i:o,size:i,lastModified:a,A:c,M:s,U:f,version:u,u:l,l:w,v:d,k:y,prefix:h};if(-1===c){const t=new Uint8Array(500);p.A=0,e(p,t);const n=21;p.A=function(t,n){const e=(2<<n)-1;let r=0;for(const n of t)r=r+n&e;return r}(t,n)}return p}function e(t,n,e=0){n=n.subarray(e,e+500),r(t.name,n,0,100),o(t.mode,n,100,8),o(t.o,n,108,8),o(t.i,n,116,8),o(t.size,n,124,12),o(t.lastModified,n,136,12),o(t.A,n,148,8),o(t.M,n,156,1),r(t.U,n,157,100),o(t.version,n,263,3),r(t.u,n,265,32),r(t.l,n,297,32),-1===t.v?n.fill(0,329,337):o(t.v,n,329,8),-1===t.k?n.fill(0,337,345):o(t.k,n,337,8),r(t.prefix,n,345,155)}function r(t,n,e=0,r=n.length-e){n=n.subarray(e,e+r);const o=(new TextEncoder).encodeInto(t,n).written;o<r&&(n[o]=0)}function o(t,n,e=0,r=n.length-e){Math.ceil(Math.log2(t)/3)<r&&(n[e+--r]=0);for(let o=r-1;o>=e;o--){const e=48+(7&t);t>>=3,n[o]=e}}class i extends File{#e;constructor(t,n,e,r){super(t,n,r),this.#e=e}get webkitRelativePath(){return this.#e}}function a(t,n=0,e=t.length-n){t=new Uint8Array(t,n,e);const r=new TextDecoder;for(let n=0;n<e;n++)if(0===t[n]){t=t.subarray(0,n);break}return r.decode(t)}function c(t,n,e){t=new Uint8Array(t,n,e);let r=0;for(const n of t){if(0===n)break;r<<=3,n<49||55<n||(r|=n-48)}return r}function s(t){return t.every((t=>0===t))}"function"==typeof define&&define.amd?define((function(){return{TarArchive:t}})):"object"==typeof module&&module?module.exports.TarArchive=t:"object"==typeof exports&&exports?exports.TarArchive=t:"object"==typeof window&&window?window.TarArchive=t:globalThis.TarArchive=t})();