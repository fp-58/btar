(()=>{const t=512;class n{#t=new Map;#n=[];t(t,n,r){t.endsWith("/")&&(t=t.substring(0,t.length-1));const o=t.lastIndexOf("/"),i=e(t.substring(o+1),r?.mode??420,r?.o??0,r?.i??0,n.size,n.lastModified,-1,0,"",0,r?.u??"",r?.l??"",0,0,t.substring(0,o+1));this.#t.set(t,this.#n.length),this.#n.push({h:i,content:n})}static async p(r){let o=0;const i=new n;for(let n=await u();n;n=await u()){let e=o*t,c=e+n.size;if(r.size<c)throw Error(`Malformed archive: Expected size ${c}, got size ${r.size}`);let s,f=n.prefix+n.name;if(f.endsWith("/")){let t=f.substring(0,f.length-1),n=t.lastIndexOf("/");s=t.substring(n)}else{let t=f.lastIndexOf("/");s=f.substring(t)}const u=new a([r.slice(e,c)],s,f,{lastModified:n.lastModified,m:"transparent"});i.#t.set(f,i.#n.length),i.#n.push({h:n,content:u}),o+=Math.ceil(n.size/t)}async function u(){const n=await async function(){const n=await l();r.size-o*t>-512&&o++;return n}();if(f(n)){if(f(await l()))return null}return e(c(n,0,100),s(n,100,8),s(n,108,8),s(n,116,8),s(n,124,12),s(n,136,12),s(n,148,8),s(n,156,1),c(n,157,100),s(n,263,3),c(n,265,32),c(n,297,32),s(n,329,8),s(n,337,8),c(n,345,155))}async function l(){let n=o*o,e=n+t;if(r.size<n)return new Uint8Array(t);if(r.size<e){const e=new Uint8Array(t),o=r.slice(n),i=new Uint8Array(await o.arrayBuffer());return e.set(i),e}{const t=r.slice(n,e);return new Uint8Array(await t.arrayBuffer())}}}toBlob(){const n=[];for(const e of this.#n){const o=new Uint8Array(t);if(r(e.h,o),n.push(o),e.content){n.push(e.content);let r=e.content.size%t;if(r>0){const e=new ArrayBuffer(t-r);n.push(e)}}}const e=new ArrayBuffer(1024);return n.push(e),new Blob(n,{m:"transparent",type:"application/x-tar"})}}function e(t,n,e,o,i,a,c,s,f,u,l,w,d,y,h){const p={name:t,mode:n,o:e,i:o,size:i,lastModified:a,A:c,M:s,U:f,version:u,u:l,l:w,v:d,k:y,prefix:h};if(-1===c){const t=new Uint8Array(500);p.A=0,r(p,t);const n=21;p.A=function(t,n){const e=(2<<n)-1;let r=0;for(const n of t)r=r+n&e;return r}(t,n)}return p}function r(t,n,e=0){n=n.subarray(e,e+500),o(t.name,n,0,100),i(t.mode,n,100,8),i(t.o,n,108,8),i(t.i,n,116,8),i(t.size,n,124,12),i(t.lastModified,n,136,12),i(t.A,n,148,8),i(t.M,n,156,1),o(t.U,n,157,100),i(t.version,n,263,3),o(t.u,n,265,32),o(t.l,n,297,32),-1===t.v?n.fill(0,329,337):i(t.v,n,329,8),-1===t.k?n.fill(0,337,345):i(t.k,n,337,8),o(t.prefix,n,345,155)}function o(t,n,e=0,r=n.length-e){n=n.subarray(e,e+r);const o=(new TextEncoder).encodeInto(t,n).written;o<r&&(n[o]=0)}function i(t,n,e=0,r=n.length-e){Math.ceil(Math.log2(t)/3)<r&&(n[e+--r]=0);for(let o=r-1;o>=e;o--){const e=48+(7&t);t>>=3,n[o]=e}}class a extends File{#e;constructor(t,n,e,r){super(t,n,r),this.#e=e}get webkitRelativePath(){return this.#e}}function c(t,n=0,e=t.length-n){t=new Uint8Array(t,n,e);const r=new TextDecoder;for(let n=0;n<e;n++)if(0===t[n]){t=t.subarray(0,n);break}return r.decode(t)}function s(t,n,e){t=new Uint8Array(t,n,e);let r=0;for(const n of t){if(0===n)break;r<<=3,n<49||55<n||(r|=n-48)}return r}function f(t){return t.every((t=>0===t))}"function"==typeof define&&define.amd?define((function(){return{TarArchive:n}})):"object"==typeof module&&module?module.exports.TarArchive=n:"object"==typeof exports&&exports?exports.TarArchive=n:"object"==typeof window&&window?window.TarArchive=n:globalThis.TarArchive=n})();