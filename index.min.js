(()=>{const t=512;class e{#t=new Map;#e=[];t(t,e,r){t.endsWith("/")&&(t=t.substring(0,t.length-1));const i=t.lastIndexOf("/"),o=n(t.substring(i+1),r?.mode??420,r?.i??0,r?.o??0,e.size,e.lastModified,-1,0,"",0,r?.u??"",r?.l??"",0,0,t.substring(0,i+1));this.#t.set(t,this.#e.length),this.#e.push({h:o,content:e})}static async p(r){let i=0;const o=new e;for(let e=await u();e;e=await u()){let n=i*t,c=n+e.size;if(r.size<c)throw Error(`Malformed archive: Expected size ${c}, got size ${r.size}`);let s,f=e.prefix+e.name;if(f.endsWith("/")){let t=f.substring(0,f.length-1),e=t.lastIndexOf("/");s=t.substring(e)}else{let t=f.lastIndexOf("/");s=f.substring(t)}const u=new a([r.slice(n,c)],s,f,{lastModified:e.lastModified,m:"transparent"});o.#t.set(f,o.#e.length),o.#e.push({h:e,content:u}),i+=Math.ceil(e.size/t)}async function u(){const e=await async function(){const e=await l();r.size-i*t>-512&&i++;return e}();if(f(e)){if(f(await l()))return null}return n(c(e,0,100),s(e,100,8),s(e,108,8),s(e,116,8),s(e,124,12),s(e,136,12),s(e,148,8),s(e,156,1),c(e,157,100),s(e,263,3),c(e,265,32),c(e,297,32),s(e,329,8),s(e,337,8),c(e,345,155))}async function l(){let e=i*i,n=e+t;if(r.size<e)return new Uint8Array(t);if(r.size<n){const n=new Uint8Array(t),i=r.slice(e),o=new Uint8Array(await i.arrayBuffer());return n.set(o),n}{const t=r.slice(e,n);return new Uint8Array(await t.arrayBuffer())}}}toBlob(){const e=[];for(const n of this.#e){const i=new Uint8Array(t);if(r(n.h,i),e.push(i),n.content){e.push(n.content);let r=n.content.size%t;if(r>0){const n=new ArrayBuffer(t-r);e.push(n)}}}const n=new ArrayBuffer(1024);return e.push(n),new Blob(e,{m:"transparent",type:"application/x-tar"})}}function n(t,e,n,i,o,a,c,s,f,u,l,w,d,y,h){const p={name:t,mode:e,i:n,o:i,size:o,lastModified:a,A:c,M:s,U:f,version:u,u:l,l:w,v:d,k:y,prefix:h};if(-1===c){const t=new Uint8Array(500);r(p,t);const e=21;p.A=function(t,e){const n=(2<<e)-1,r=148,i=156;let o=0;for(let e=0;e<t.length;e++){let a=t[e];r<=e&&e<=i&&(a=32),o=o+a&n}return o}(t,e)}return p}function r(t,e,n=0){e=e.subarray(n,n+500),i(t.name,e,0,100),o(t.mode,e,100,8),o(t.i,e,108,8),o(t.o,e,116,8),o(t.size,e,124,12),o(t.lastModified,e,136,12),o(t.A,e,148,8),o(t.M,e,156,1),i(t.U,e,157,100),o(t.version,e,263,3),i(t.u,e,265,32),i(t.l,e,297,32),-1===t.v?e.fill(0,329,337):o(t.v,e,329,8),-1===t.k?e.fill(0,337,345):o(t.k,e,337,8),i(t.prefix,e,345,155)}function i(t,e,n=0,r=e.length-n){e=e.subarray(n,n+r);const i=(new TextEncoder).encodeInto(t,e).written;i<r&&(e[i]=0)}function o(t,e,n=0,r=e.length-n){Math.ceil(Math.log2(t)/3)<r&&(e[n+--r]=0);for(let i=r-1;i>=n;i--){const n=48+(7&t);t>>=3,e[i]=n}}class a extends File{#n;constructor(t,e,n,r){super(t,e,r),this.#n=n}get webkitRelativePath(){return this.#n}}function c(t,e=0,n=t.length-e){t=new Uint8Array(t,e,n);const r=new TextDecoder;for(let e=0;e<n;e++)if(0===t[e]){t=t.subarray(0,e);break}return r.decode(t)}function s(t,e,n){t=new Uint8Array(t,e,n);let r=0;for(const e of t){if(0===e)break;r<<=3,e<49||55<e||(r|=e-48)}return r}function f(t){return t.every((t=>0===t))}"function"==typeof define&&define.amd?define((function(){return{TarArchive:e}})):"object"==typeof module&&module?module.exports.TarArchive=e:"object"==typeof exports&&exports?exports.TarArchive=e:"object"==typeof window&&window?window.TarArchive=e:globalThis.TarArchive=e})();